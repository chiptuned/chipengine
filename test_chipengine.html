<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChipEngine Test Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            text-align: center;
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 40px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            transition: transform 0.3s;
        }
        
        .test-card:hover {
            transform: translateY(-5px);
        }
        
        .test-card h2 {
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .btn.primary {
            background: #4CAF50;
            border-color: #4CAF50;
        }
        
        .btn.secondary {
            background: #FF6B6B;
            border-color: #FF6B6B;
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        
        .result.show {
            display: block;
        }
        
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.9em;
            margin-left: 10px;
        }
        
        .status.success {
            background: #4CAF50;
        }
        
        .status.error {
            background: #FF6B6B;
        }
        
        .rps-choices {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .choice-btn {
            font-size: 3em;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid transparent;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .choice-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .choice-btn.selected {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.3);
        }
        
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            color: white;
            font-size: 1em;
        }
        
        input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .loading {
            text-align: center;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ ChipEngine Test Suite</h1>
        <p class="subtitle">Complete testing interface for ChipEngine API</p>
        
        <div class="test-grid">
            <!-- Health Check -->
            <div class="test-card">
                <h2>üè• Health Check</h2>
                <p>Test if the API is running and healthy</p>
                <button class="btn primary" onclick="testHealth()">Check Health</button>
                <div id="healthResult" class="result"></div>
            </div>
            
            <!-- Bot Registration -->
            <div class="test-card">
                <h2>ü§ñ Bot Registration</h2>
                <p>Register a new bot and get API key</p>
                <input type="text" id="botName" placeholder="Enter bot name" value="TestBot">
                <button class="btn primary" onclick="registerBot()">Register Bot</button>
                <div id="botResult" class="result"></div>
            </div>
            
            <!-- Play RPS Game -->
            <div class="test-card">
                <h2>üéØ Play Rock Paper Scissors</h2>
                <p>Play a quick game against the bot</p>
                <div class="rps-choices">
                    <button class="choice-btn" onclick="selectChoice('rock')" data-choice="rock">ü™®</button>
                    <button class="choice-btn" onclick="selectChoice('paper')" data-choice="paper">üìÑ</button>
                    <button class="choice-btn" onclick="selectChoice('scissors')" data-choice="scissors">‚úÇÔ∏è</button>
                </div>
                <button class="btn primary" onclick="playRPS()" id="playBtn" disabled>Play Game</button>
                <div id="rpsResult" class="result"></div>
            </div>
            
            <!-- Performance Test -->
            <div class="test-card">
                <h2>‚ö° Performance Test</h2>
                <p>Test batch processing performance</p>
                <input type="number" id="batchSize" placeholder="Number of games" value="1000" min="1" max="100000">
                <button class="btn secondary" onclick="testPerformance()">Run Performance Test</button>
                <div id="perfResult" class="result"></div>
            </div>
            
            <!-- Bot API Test -->
            <div class="test-card">
                <h2>üîß Bot API Test</h2>
                <p>Complete bot workflow test</p>
                <input type="text" id="apiKey" placeholder="Enter API key (from registration)">
                <button class="btn primary" onclick="testBotAPI()">Test Bot API</button>
                <div id="botApiResult" class="result"></div>
            </div>
            
            <!-- API Documentation -->
            <div class="test-card">
                <h2>üìö API Documentation</h2>
                <p>Explore the full API documentation</p>
                <button class="btn" onclick="window.open('/docs', '_blank')">Open Swagger UI</button>
                <button class="btn" onclick="window.open('/redoc', '_blank')">Open ReDoc</button>
                <div class="metrics">
                    <div class="metric">
                        <div>Endpoints</div>
                        <div class="metric-value">15+</div>
                    </div>
                    <div class="metric">
                        <div>Performance</div>
                        <div class="metric-value">15M+</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- System Status -->
        <div class="test-card">
            <h2>üìä System Status</h2>
            <div id="systemMetrics" class="metrics">
                <div class="metric">
                    <div>API Status</div>
                    <div class="metric-value" id="apiStatus">-</div>
                </div>
                <div class="metric">
                    <div>Active Bots</div>
                    <div class="metric-value" id="activeBots">-</div>
                </div>
                <div class="metric">
                    <div>Active Games</div>
                    <div class="metric-value" id="activeGames">-</div>
                </div>
                <div class="metric">
                    <div>Version</div>
                    <div class="metric-value" id="version">-</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';
        let selectedChoice = null;
        let currentApiKey = null;
        
        // Initialize on load
        window.onload = () => {
            updateSystemStatus();
            setInterval(updateSystemStatus, 5000); // Update every 5 seconds
        };
        
        async function updateSystemStatus() {
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                
                document.getElementById('apiStatus').textContent = 'üü¢ Online';
                document.getElementById('version').textContent = data.version || '0.1.0';
                document.getElementById('activeBots').textContent = data.bots_count || '0';
                document.getElementById('activeGames').textContent = data.active_games || '0';
            } catch (error) {
                document.getElementById('apiStatus').textContent = 'üî¥ Offline';
            }
        }
        
        async function testHealth() {
            const resultDiv = document.getElementById('healthResult');
            resultDiv.innerHTML = '<div class="loading">Testing health...</div>';
            resultDiv.classList.add('show');
            
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <h3>‚úÖ API is Healthy!</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <h3>‚ùå Health Check Failed</h3>
                    <p>Error: ${error.message}</p>
                    <p>Make sure the API is running at ${API_URL}</p>
                `;
            }
        }
        
        async function registerBot() {
            const botName = document.getElementById('botName').value;
            const resultDiv = document.getElementById('botResult');
            
            if (!botName) {
                alert('Please enter a bot name');
                return;
            }
            
            resultDiv.innerHTML = '<div class="loading">Registering bot...</div>';
            resultDiv.classList.add('show');
            
            try {
                const response = await fetch(`${API_URL}/bots/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: botName })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    currentApiKey = data.api_key;
                    document.getElementById('apiKey').value = data.api_key;
                    
                    resultDiv.innerHTML = `
                        <h3>‚úÖ Bot Registered Successfully!</h3>
                        <p><strong>Bot ID:</strong> ${data.bot_id}</p>
                        <p><strong>Name:</strong> ${data.name}</p>
                        <p><strong>API Key:</strong> <code>${data.api_key}</code></p>
                        <p style="color: #FFD93D; margin-top: 10px;">‚ö†Ô∏è Save this API key - it cannot be retrieved later!</p>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <h3>‚ùå Registration Failed</h3>
                        <p>Error: ${data.detail || 'Unknown error'}</p>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <h3>‚ùå Registration Error</h3>
                    <p>Error: ${error.message}</p>
                `;
            }
        }
        
        function selectChoice(choice) {
            selectedChoice = choice;
            
            // Update UI
            document.querySelectorAll('.choice-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`[data-choice="${choice}"]`).classList.add('selected');
            document.getElementById('playBtn').disabled = false;
        }
        
        async function playRPS() {
            if (!selectedChoice) {
                alert('Please select rock, paper, or scissors');
                return;
            }
            
            const resultDiv = document.getElementById('rpsResult');
            resultDiv.innerHTML = '<div class="loading">Playing game...</div>';
            resultDiv.classList.add('show');
            
            const botChoice = ['rock', 'paper', 'scissors'][Math.floor(Math.random() * 3)];
            
            try {
                const response = await fetch(`${API_URL}/games/play`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        game_type: 'rps',
                        player1: { name: 'You', move: selectedChoice },
                        player2: { name: 'Bot', move: botChoice }
                    })
                });
                
                const data = await response.json();
                
                const emojis = { rock: 'ü™®', paper: 'üìÑ', scissors: '‚úÇÔ∏è' };
                
                resultDiv.innerHTML = `
                    <h3>Game Result</h3>
                    <p><strong>You:</strong> ${selectedChoice} ${emojis[selectedChoice]}</p>
                    <p><strong>Bot:</strong> ${botChoice} ${emojis[botChoice]}</p>
                    <p><strong>Winner:</strong> ${data.winner || 'Tie!'}</p>
                    <p><strong>Game ID:</strong> ${data.game_id}</p>
                `;
                
                // Reset selection
                selectedChoice = null;
                document.querySelectorAll('.choice-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                document.getElementById('playBtn').disabled = true;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <h3>‚ùå Game Error</h3>
                    <p>Error: ${error.message}</p>
                `;
            }
        }
        
        async function testPerformance() {
            const batchSize = parseInt(document.getElementById('batchSize').value);
            const resultDiv = document.getElementById('perfResult');
            
            if (!batchSize || batchSize < 1) {
                alert('Please enter a valid batch size');
                return;
            }
            
            resultDiv.innerHTML = '<div class="loading">Running performance test...</div>';
            resultDiv.classList.add('show');
            
            try {
                const startTime = performance.now();
                
                // Generate random games
                const games = [];
                for (let i = 0; i < batchSize; i++) {
                    const choices = ['rock', 'paper', 'scissors'];
                    games.push({
                        game_type: 'rps',
                        player1: { name: 'Player1', move: choices[Math.floor(Math.random() * 3)] },
                        player2: { name: 'Player2', move: choices[Math.floor(Math.random() * 3)] }
                    });
                }
                
                // Process games
                const promises = games.map(game => 
                    fetch(`${API_URL}/games/play`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(game)
                    })
                );
                
                await Promise.all(promises);
                
                const endTime = performance.now();
                const duration = (endTime - startTime) / 1000; // seconds
                const gamesPerSecond = batchSize / duration;
                
                resultDiv.innerHTML = `
                    <h3>‚ö° Performance Test Complete!</h3>
                    <p><strong>Games played:</strong> ${batchSize.toLocaleString()}</p>
                    <p><strong>Duration:</strong> ${duration.toFixed(3)}s</p>
                    <p><strong>Games/second:</strong> ${gamesPerSecond.toFixed(0).toLocaleString()}</p>
                    <div style="margin-top: 15px; padding: 10px; background: rgba(76, 175, 80, 0.2); border-radius: 5px;">
                        <p>üí° The backend can handle 15M+ games/second!</p>
                        <p>Browser limitations affect client-side performance.</p>
                    </div>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <h3>‚ùå Performance Test Error</h3>
                    <p>Error: ${error.message}</p>
                `;
            }
        }
        
        async function testBotAPI() {
            const apiKey = document.getElementById('apiKey').value;
            const resultDiv = document.getElementById('botApiResult');
            
            if (!apiKey) {
                alert('Please enter an API key (register a bot first)');
                return;
            }
            
            resultDiv.innerHTML = '<div class="loading">Testing bot API workflow...</div>';
            resultDiv.classList.add('show');
            
            try {
                const headers = {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                };
                
                // Step 1: Get bot info
                const botResponse = await fetch(`${API_URL}/bots/me`, { headers });
                const botData = await botResponse.json();
                
                // Step 2: Create a game
                const createResponse = await fetch(`${API_URL}/games/`, {
                    method: 'POST',
                    headers,
                    body: JSON.stringify({
                        game_type: 'rps',
                        players: ['BotPlayer1', 'BotPlayer2'],
                        config: {}
                    })
                });
                const gameData = await createResponse.json();
                
                // Step 3: Make moves
                const move1Response = await fetch(`${API_URL}/games/${gameData.game_id}/moves`, {
                    method: 'POST',
                    headers,
                    body: JSON.stringify({
                        player: 'BotPlayer1',
                        action: 'rock',
                        data: {}
                    })
                });
                
                const move2Response = await fetch(`${API_URL}/games/${gameData.game_id}/moves`, {
                    method: 'POST',
                    headers,
                    body: JSON.stringify({
                        player: 'BotPlayer2',
                        action: 'scissors',
                        data: {}
                    })
                });
                
                const finalState = await move2Response.json();
                
                resultDiv.innerHTML = `
                    <h3>‚úÖ Bot API Test Complete!</h3>
                    <h4>1. Bot Info:</h4>
                    <pre>${JSON.stringify(botData, null, 2)}</pre>
                    <h4>2. Game Created:</h4>
                    <p>Game ID: ${gameData.game_id}</p>
                    <h4>3. Game Result:</h4>
                    <p>Winner: ${finalState.game_state.winner}</p>
                    <p>Status: ${finalState.game_state.status}</p>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <h3>‚ùå Bot API Test Error</h3>
                    <p>Error: ${error.message}</p>
                    <p>Make sure you have a valid API key from bot registration.</p>
                `;
            }
        }
    </script>
</body>
</html>